# èˆ¹èˆ¶åŠ¨åŠ›å­¦å»ºæ¨¡ä¸NMPCæ§åˆ¶ç³»ç»Ÿ

[English](README.md) | [ä¸­æ–‡](README_CN.md)

## ğŸš¢ é¡¹ç›®æ¦‚è¿°

æœ¬é¡¹ç›®æ˜¯ä¸€ä¸ªå®Œæ•´çš„èˆ¹èˆ¶åŠ¨åŠ›å­¦å»ºæ¨¡ä¸éçº¿æ€§æ¨¡å‹é¢„æµ‹æ§åˆ¶ï¼ˆNMPCï¼‰ç³»ç»Ÿï¼Œæ”¯æŒä¸‰ç§ä¸åŒå¤æ‚åº¦çš„èˆ¹èˆ¶åŠ¨åŠ›å­¦æ¨¡å‹ã€‚ç³»ç»Ÿæä¾›äº†ä»æ•°æ®å¤„ç†ã€æ¨¡å‹è¾¨è¯†ã€éªŒè¯åˆ°NMPCæ§åˆ¶çš„å®Œæ•´å·¥ä½œæµç¨‹ï¼Œå…·æœ‰ç»Ÿä¸€çš„æ•°æ®æ ¼å¼å’Œç®€åŒ–çš„å¯è§†åŒ–åŠŸèƒ½ã€‚

## âœ¨ ä¸»è¦ç‰¹æ€§

- ğŸ”§ **ä¸‰ç§èˆ¹èˆ¶åŠ¨åŠ›å­¦æ¨¡å‹**ï¼šæ”¯æŒä¸åŒå¤æ‚åº¦çš„èˆ¹èˆ¶å»ºæ¨¡éœ€æ±‚
- ğŸ“Š **ç»Ÿä¸€æ•°æ®æ ¼å¼**ï¼šæ ‡å‡†åŒ–çš„æ•°æ®è¾“å…¥è¾“å‡ºæ ¼å¼
- ğŸ¯ **NMPCæ§åˆ¶å™¨**ï¼šå…ˆè¿›çš„éçº¿æ€§æ¨¡å‹é¢„æµ‹æ§åˆ¶ç®—æ³•
- ğŸ“ˆ **ç®€åŒ–å¯è§†åŒ–**ï¼šå…³é”®å‚æ•°çš„æ¸…æ™°å›¾è¡¨å±•ç¤º
- ğŸ”„ **æ¨¡å—åŒ–è®¾è®¡**ï¼šæ˜“äºæ‰©å±•å’Œç»´æŠ¤çš„ä»£ç ç»“æ„
- âš™ï¸ **é…ç½®ç®¡ç†**ï¼šç»Ÿä¸€çš„é…ç½®æ–‡ä»¶ç®¡ç†ç³»ç»Ÿ
- ğŸ–¥ï¸ **å‘½ä»¤è¡Œç•Œé¢**ï¼šæ”¯æŒæ‰¹å¤„ç†å’Œäº¤äº’å¼æ“ä½œ
- ğŸ” **å¤šç§æ»¤æ³¢æ–¹æ³•**ï¼šSavitzky-Golayã€æ‰©å±•å¡å°”æ›¼æ»¤æ³¢ç­‰

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

### æ ¸å¿ƒæ¨¡å—

- **ç»Ÿä¸€æ¨¡å‹æ¥å£** (`model_interface.py`)ï¼šæ”¯æŒä¸‰ç§æ¨¡å‹çš„ç»Ÿä¸€è°ƒç”¨
- **é€šç”¨NMPCæ§åˆ¶å™¨** (`nmpc_tracking/universal_nmpc_controller.py`)ï¼šç»Ÿä¸€çš„æ§åˆ¶æ¥å£
- **æ•°æ®æ ¼å¼æ ‡å‡†** (`src/utils/data_format.py`)ï¼šæ ‡å‡†åŒ–æ•°æ®å¤„ç†
- **ç®€åŒ–å¯è§†åŒ–** (`src/utils/simplified_visualizer.py`)ï¼šå…³é”®å‚æ•°å¯è§†åŒ–
- **é…ç½®ç®¡ç†** (`config_manager.py`)ï¼šç»Ÿä¸€é…ç½®ç®¡ç†
- **å‚æ•°è¾¨è¯†å·¥å…·** (`model_identifier.py`)ï¼šå‘½ä»¤è¡Œå‚æ•°è¾¨è¯†å·¥å…·

### ä¸‰ç§èˆ¹èˆ¶æ¨¡å‹

1. **æ¨¡å‹1**ï¼šæ ‡å‡†æ¨¡å‹ï¼Œé€‚ç”¨äºåŸºç¡€åº”ç”¨
2. **æ¨¡å‹2**ï¼šåˆ†ç¦»æ¨è¿›å™¨è¾“å…¥æ¨¡å‹ï¼Œå¹³è¡¡ç²¾åº¦ä¸è®¡ç®—æ•ˆç‡
3. **æ¨¡å‹3**ï¼šç®€åŒ–æ¨¡å‹ï¼Œé€‚ç”¨äºå¿«é€Ÿè®¡ç®—åœºæ™¯

## ğŸ”§ å®‰è£…ä¾èµ–

```bash
pip install numpy scipy pandas matplotlib casadi control
```

## ğŸ“ é¡¹ç›®ç»“æ„

```
MI/
â”œâ”€â”€ .codebuddy/
â”‚   â””â”€â”€ rules/
â”œâ”€â”€ .vs/
â”‚   â”œâ”€â”€ MI/
â”‚   â”‚   â”œâ”€â”€ FileContentIndex/
â”‚   â”‚   â””â”€â”€ v17/
â”‚   â”œâ”€â”€ ProjectSettings.json
â”‚   â”œâ”€â”€ VSWorkspaceState.json
â”‚   â””â”€â”€ slnx.sqlite
â”œâ”€â”€ .vscode/
â”‚   â”œâ”€â”€ launch.json
â”‚   â””â”€â”€ settings.json
â”œâ”€â”€ README_CN.md
â”œâ”€â”€ __pycache__/
â”‚   â”œâ”€â”€ config.cpython-38.pyc
â”‚   â”œâ”€â”€ dynamics_model_interface.cpython-38.pyc
â”‚   â””â”€â”€ model_interface.cpython-38.pyc
â”œâ”€â”€ config.py
â”œâ”€â”€ datas/
â”‚   â”œâ”€â”€ boat1_2_circle.xlsx
â”‚   â””â”€â”€ boat1_2_sin.xlsx
â”œâ”€â”€ examples/
â”‚   â”œâ”€â”€ demo.py
â”‚   â”œâ”€â”€ demo2.py
â”‚   â””â”€â”€ demo3.py
â”œâ”€â”€ model_identifier.py
â”œâ”€â”€ model_results/
â”‚   â”œâ”€â”€ model_1_identification_metadata.json
â”‚   â”œâ”€â”€ model_1_identification_results.csv
â”‚   â”œâ”€â”€ model_1_identification_results.png
â”‚   â”œâ”€â”€ model_1_params.json
â”‚   â”œâ”€â”€ model_1_performance_analysis.png
â”‚   â”œâ”€â”€ model_1_results.csv
â”‚   â”œâ”€â”€ model_1_results_metadata.json
â”‚   â”œâ”€â”€ model_2_identification_metadata.json
â”‚   â”œâ”€â”€ model_2_identification_results.csv
â”‚   â”œâ”€â”€ model_2_identification_results.png
â”‚   â”œâ”€â”€ model_2_params.json
â”‚   â”œâ”€â”€ model_2_performance_analysis.png
â”‚   â”œâ”€â”€ model_2_results.csv
â”‚   â”œâ”€â”€ model_2_results_metadata.json
â”‚   â”œâ”€â”€ model_3_identification_metadata.json
â”‚   â”œâ”€â”€ model_3_identification_results.csv
â”‚   â”œâ”€â”€ model_3_identification_results.png
â”‚   â”œâ”€â”€ model_3_params.json
â”‚   â”œâ”€â”€ model_3_performance_analysis.png
â”‚   â”œâ”€â”€ model_3_results.csv
â”‚   â””â”€â”€ model_3_results_metadata.json
â”œâ”€â”€ nmpc_identified_model_results.csv
â”œâ”€â”€ nmpc_performance_report.txt
â”œâ”€â”€ nmpc_results/
â”‚   â”œâ”€â”€ nmpc_error_1_for_trajectory_1.png
â”‚   â”œâ”€â”€ nmpc_error_2_for_trajectory_2.png
â”‚   â”œâ”€â”€ nmpc_error_3_for_trajectory_3.png
â”‚   â”œâ”€â”€ nmpc_identified_model_1_for_trajectory_1_results.csv
â”‚   â”œâ”€â”€ nmpc_identified_model_2_for_trajectory_2_results.csv
â”‚   â”œâ”€â”€ nmpc_identified_model_3_for_trajectory_3_results.csv
â”‚   â”œâ”€â”€ nmpc_performance_model_1_for_trajectory_1_report.txt
â”‚   â”œâ”€â”€ nmpc_performance_model_2_for_trajectory_2_report.txt
â”‚   â”œâ”€â”€ nmpc_performance_model_3_for_trajectory_3_report.txt
â”‚   â”œâ”€â”€ nmpc_state_variables_1_for_trajectory_1.png
â”‚   â”œâ”€â”€ nmpc_state_variables_2_for_trajectory_2.png
â”‚   â”œâ”€â”€ nmpc_state_variables_3_for_trajectory_3.png
â”‚   â”œâ”€â”€ nmpc_thruster_outputs_1_for_trajectory_1.png
â”‚   â”œâ”€â”€ nmpc_thruster_outputs_2_for_trajectory_2.png
â”‚   â”œâ”€â”€ nmpc_thruster_outputs_3_for_trajectory_3.png
â”‚   â”œâ”€â”€ nmpc_trajectory_1_for_trajectory_1.png
â”‚   â”œâ”€â”€ nmpc_trajectory_2_for_trajectory_2.png
â”‚   â””â”€â”€ nmpc_trajectory_3_for_trajectory_3.png
â”œâ”€â”€ nmpc_tracking/
â”‚   â”œâ”€â”€ boat1_2_atwnmpc.py
â”‚   â””â”€â”€ identified_model_nmpc_test.py
â””â”€â”€ src/
    â”œâ”€â”€ data_processing/
    â”‚   â”œâ”€â”€ __init__.py
    â”‚   â”œâ”€â”€ __pycache__/
    â”‚   â”œâ”€â”€ data_loader.py
    â”‚   â””â”€â”€ data_preprocessor.py
    â”œâ”€â”€ model_identification/
    â”‚   â”œâ”€â”€ __init__.py
    â”‚   â”œâ”€â”€ __pycache__/
    â”‚   â”œâ”€â”€ model_equations.py
    â”‚   â””â”€â”€ parameter_optimizer.py
    â”œâ”€â”€ simulation_visualization/
    â”‚   â”œâ”€â”€ __init__.py
    â”‚   â”œâ”€â”€ __pycache__/
    â”‚   â”œâ”€â”€ simulator.py
    â”‚   â””â”€â”€ visualizer.py
    â””â”€â”€ utils/
        â”œâ”€â”€ __init__.py
        â”œâ”€â”€ __pycache__/
        â”œâ”€â”€ data_format.py
        â”œâ”€â”€ data_validator.py
        â””â”€â”€ simplified_visualizer.py
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Python 3.8+
- ä¾èµ–åŒ…ï¼šnumpy, scipy, pandas, matplotlib, casadi, control

### å®‰è£…ä¾èµ–

```bash
pip install numpy scipy pandas matplotlib casadi control
```

## ğŸ“Š å®éªŒç»“æœä¸åˆ†æ

### æ¨¡å‹è¾¨è¯†ç»“æœ

ä»¥ä¸‹æ˜¯ä½¿ç”¨ `model_identifier.py` å·¥å…·å¯¹æ¨¡å‹è¿›è¡Œå‚æ•°è¾¨è¯†åçš„ç»“æœç¤ºä¾‹ã€‚

**æ¨¡å‹1è¾¨è¯†ç»“æœ**
![æ¨¡å‹1è¾¨è¯†ç»“æœ](model_results/model_1_identification_results.png)

**æ¨¡å‹1æ€§èƒ½åˆ†æ**
![æ¨¡å‹1æ€§èƒ½åˆ†æ](model_results/model_1_performance_analysis.png)

### NMPCè½¨è¿¹è·Ÿè¸ªç»“æœ

ä½¿ç”¨è¾¨è¯†å‡ºçš„æ¨¡å‹å‚æ•°ï¼Œé€šè¿‡ `identified_model_nmpc_test.py` è¿›è¡ŒNMPCè½¨è¿¹è·Ÿè¸ªæ§åˆ¶ã€‚

**è½¨è¿¹è·Ÿè¸ªå¯¹æ¯” (æ¨¡å‹1, è½¨è¿¹1)**
![è½¨è¿¹è·Ÿè¸ªå¯¹æ¯”](nmpc_results/nmpc_trajectory_1_for_trajectory_1.png)

**è·Ÿè¸ªè¯¯å·® (æ¨¡å‹1, è½¨è¿¹1)**
![è·Ÿè¸ªè¯¯å·®](nmpc_results/nmpc_error_1_for_trajectory_1.png)

### å®éªŒæ•ˆæœå¯¹æ¯”

ä¸‹è¡¨å¯¹æ¯”äº†ä¸‰ç§æ¨¡å‹åœ¨ä¸åŒè½¨è¿¹ä¸‹çš„è·Ÿè¸ªæ€§èƒ½ï¼ˆä»¥RMSEå‡æ–¹æ ¹è¯¯å·®ä¸ºä¾‹ï¼‰ã€‚

| æ¨¡å‹ | è½¨è¿¹ | RMSE (x) | RMSE (y) | RMSE (psi) | ç»¼åˆè¯„ä»· |
| :--- | :--- | :--- | :--- | :--- | :--- |
| **æ¨¡å‹1** | è½¨è¿¹1 (æ¤­åœ†) | 0.15 | 0.20 | 0.05 | è¡¨ç°å‡è¡¡ï¼Œé€‚ç”¨äºå¤§å¤šæ•°åœºæ™¯ |
| **æ¨¡å‹2** | è½¨è¿¹2 (æ­£å¼¦) | 0.12 | 0.18 | 0.04 | ç²¾åº¦è¾ƒé«˜ï¼Œä½†è®¡ç®—ç¨æ…¢ |
| **æ¨¡å‹3** | è½¨è¿¹3 (åŒæ­£å¼¦) | 0.20 | 0.25 | 0.08 | è®¡ç®—æœ€å¿«ï¼Œä½†ç²¾åº¦ç•¥ä½ |

### æ•ˆæœåˆ†æ

- **ä¼˜åŠ¿**:
    - **æ¨¡å‹å¤šæ ·æ€§**: æä¾›äº†ä¸‰ç§ä¸åŒå¤æ‚åº¦çš„æ¨¡å‹ï¼Œå¯ä»¥æ ¹æ®ç²¾åº¦å’Œè®¡ç®—æ•ˆç‡çš„éœ€æ±‚è¿›è¡Œé€‰æ‹©ã€‚
    - **æ§åˆ¶æ€§èƒ½**: NMPCæ§åˆ¶å™¨åœ¨ä¸åŒè½¨è¿¹ä¸‹å‡è¡¨ç°å‡ºè‰¯å¥½çš„è·Ÿè¸ªæ€§èƒ½ï¼Œè¯¯å·®æ”¶æ•›å¿«ã€‚
    - **æ¨¡å—åŒ–**: ç³»ç»Ÿè®¾è®¡è‰¯å¥½ï¼Œæ˜“äºæ‰©å±•å’Œæ›¿æ¢ä¸åŒæ¨¡å—ã€‚

- **ä¸è¶³**:
    - **å‚æ•°æ•æ„Ÿæ€§**: NMPCæ§åˆ¶å™¨çš„æ€§èƒ½å¯¹å‚æ•°ï¼ˆå¦‚é¢„æµ‹æ—¶åŸŸã€æ§åˆ¶æƒé‡ï¼‰è¾ƒä¸ºæ•æ„Ÿï¼Œéœ€è¦ä»”ç»†è°ƒä¼˜ã€‚
    - **å®æ—¶æ€§æŒ‘æˆ˜**: å¯¹äºå¤æ‚æ¨¡å‹ï¼ˆå¦‚æ¨¡å‹2ï¼‰ï¼Œåœ¨è®¡ç®—èƒ½åŠ›æœ‰é™çš„ç¡¬ä»¶ä¸Šå®ç°é«˜é¢‘ç‡å®æ—¶æ§åˆ¶ä»æœ‰æŒ‘æˆ˜ã€‚

## ğŸ“– å‚æ•°è¾¨è¯†å·¥å…·ä½¿ç”¨æŒ‡å—

### åŸºæœ¬å‘½ä»¤è¡Œä½¿ç”¨

è¿è¡Œå‚æ•°è¾¨è¯†è„šæœ¬ï¼Œæ”¯æŒå¤šç§æ¨¡å‹ç±»å‹ã€æ•°æ®æ–‡ä»¶å’Œæ»¤æ³¢æ–¹æ³•é€‰æ‹©ï¼š

```bash
# åŸºæœ¬ä½¿ç”¨ï¼ˆä½¿ç”¨é»˜è®¤å‚æ•°ï¼‰
python model_identifier.py --model model_1
python model_identifier.py --model model_2
python model_identifier.py --model model_3

# æŒ‡å®šæ•°æ®æ–‡ä»¶å’Œæ»¤æ³¢æ–¹æ³•
python model_identifier.py --model model_1 --data datas/boat1_2_circle.xlsx --filter savgol
python model_identifier.py --model model_2 --data datas/boat1_2_sin.xlsx --filter ekf
python model_identifier.py --model model_3 --filter lowpass

# è‡ªå®šä¹‰æ•°æ®èŒƒå›´å’Œè¾“å‡ºç›®å½•
python model_identifier.py --model model_1 --start_row 100 --row_count 1000 --output_dir results
python model_identifier.py --model model_1 --data datas/boat1_2_sin.xlsx --filter savgol --optimizer trust-constr --start_row 0 --row_count 500 --output_dir test_results
# å¯ç”¨äº¤äº’å¼æ¨¡å¼ï¼ˆæ¨èæ–°ç”¨æˆ·ä½¿ç”¨ï¼‰
python model_identifier.py --interactive
```

### å‘½ä»¤è¡Œå‚æ•°è¯´æ˜

| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `--model` | int | 1 | æ¨¡å‹ç±»å‹ï¼š1=æ ‡å‡†æ¨¡å‹, 2=åˆ†ç¦»æ¨è¿›å™¨è¾“å…¥æ¨¡å‹, 3=ç®€åŒ–æ¨¡å‹ |
| `--data` | str | datas/boat1_2_sin.xlsx | æ•°æ®æ–‡ä»¶è·¯å¾„ |
| `--filter` | str | savgol | æ»¤æ³¢æ–¹æ³•ï¼šsavgol/ekf/lowpass/none |
| `--interactive` | flag | False | å¯ç”¨äº¤äº’å¼æ¨¡å¼ |
| `--start_row` | int | 0 | æ•°æ®èµ·å§‹è¡Œ |
| `--row_count` | int | 1500 | è¯»å–æ•°æ®è¡Œæ•° |
| `--output_dir` | str | . | è¾“å‡ºæ–‡ä»¶ç›®å½• |

### æ»¤æ³¢æ–¹æ³•è¯´æ˜

- **savgol**: Savitzky-Golayå¹³æ»‘æ»¤æ³¢ï¼ˆæ¨èï¼Œé€‚ç”¨äºå¤§å¤šæ•°æƒ…å†µï¼‰
- **ekf**: æ‰©å±•å¡å°”æ›¼æ»¤æ³¢ï¼ˆé€‚ç”¨äºå™ªå£°è¾ƒå¤§çš„æ•°æ®ï¼‰
- **lowpass**: ä½é€šæ»¤æ³¢ï¼ˆé€‚ç”¨äºé«˜é¢‘å™ªå£°æ˜æ˜¾çš„æ•°æ®ï¼‰
- **none**: æ— æ»¤æ³¢ï¼ˆé€‚ç”¨äºå·²é¢„å¤„ç†çš„å¹²å‡€æ•°æ®ï¼‰

### ç»“æœæ˜¾ç¤º

ä¸‹è¡¨å±•ç¤ºäº† `model_results` ç›®å½•ä¸­ä¸‰ç§å…¸å‹å®éªŒçš„ç»“æœã€‚

| æ¨¡å‹ | è¾¨è¯†ç»“æœ | æ€§èƒ½åˆ†æ |
| :--- | :--- | :--- |
| **æ¨¡å‹1** |![æ¨¡å‹1è¾¨è¯†ç»“æœ](model_results/model_1_identification_results.png) | ![æ¨¡å‹1æ€§èƒ½åˆ†æ](model_results/model_1_performance_analysis.png) |
| **æ¨¡å‹2** |![æ¨¡å‹2è¾¨è¯†ç»“æœ](model_results/model_2_identification_results.png) | ![æ¨¡å‹2æ€§èƒ½åˆ†æ](model_results/model_2_performance_analysis.png) |
| **æ¨¡å‹3** |![æ¨¡å‹3è¾¨è¯†ç»“æœ](model_results/model_3_identification_results.png) | ![æ¨¡å‹3æ€§èƒ½åˆ†æ](model_results/model_3_performance_analysis.png) |

### å·¥ä½œæµç¨‹

å‚æ•°è¾¨è¯†çš„å®Œæ•´å·¥ä½œæµç¨‹åŒ…æ‹¬ï¼š

1. **æ•°æ®è¯»å–**ï¼šä»Excelæ–‡ä»¶ä¸­è¯»å–å®éªŒæ•°æ®
2. **æ•°æ®é¢„å¤„ç†**ï¼šåº”ç”¨é€‰å®šçš„æ»¤æ³¢æ–¹æ³•è¿›è¡Œæ•°æ®å¤„ç†
3. **å‚æ•°ä¼˜åŒ–**ï¼šä½¿ç”¨ä¼˜åŒ–ç®—æ³•è¾¨è¯†æ¨¡å‹å‚æ•°
4. **æ¨¡å‹éªŒè¯**ï¼šè®¡ç®—RMSEç­‰æ€§èƒ½æŒ‡æ ‡
5. **ç»“æœå¯è§†åŒ–**ï¼šç”Ÿæˆå‚æ•°è¾¨è¯†å’Œæ€§èƒ½åˆ†æå›¾è¡¨
6. **æ•°æ®å¯¼å‡º**ï¼šä¿å­˜å‚æ•°ã€ç»“æœæ•°æ®å’Œå…ƒæ•°æ®


## ğŸ“Š è¾“å‡ºæ–‡ä»¶è¯´æ˜

### å‚æ•°è¾¨è¯†å·¥å…·è¾“å‡º

è¿è¡Œå‚æ•°è¾¨è¯†åï¼Œç³»ç»Ÿä¼šç”Ÿæˆä»¥ä¸‹æ–‡ä»¶ï¼š

1. **å‚æ•°æ–‡ä»¶**: `model_{type}_params.json`
   - è¾¨è¯†å¾—åˆ°çš„æ¨¡å‹å‚æ•°
   - ä¼˜åŒ–ç»“æœä¿¡æ¯
==æ³¨æ„ï¼šå‚æ•°æ–‡ä»¶ä¿å­˜åœ¨`model_results/`ç›®å½•ä¸‹ï¼Œé‡Œé¢çš„å‚æ•°è¯·ä¸è¦è¶…è¿‡10ï¼Œè¶…è¿‡åˆ™è‡ªåŠ¨æ¶ˆå‡ä¸º0.çš„å°æ•°==
2. **ç»“æœæ•°æ®**: `model_{type}_identification_results.csv`
   - æ—¶é—´åºåˆ—æ•°æ®
   - å®é™…å€¼ä¸ä»¿çœŸå€¼å¯¹æ¯”

3. **å…ƒæ•°æ®**: `model_{type}_identification_metadata.json`
   - å¤„ç†ä¿¡æ¯å’Œé…ç½®
   - æ€§èƒ½æŒ‡æ ‡

4. **å¯è§†åŒ–å›¾è¡¨**: 
   - `model_{type}_identification_results.png`: å‚æ•°è¾¨è¯†ç»“æœ
   - `model_{type}_performance_analysis.png`: æ€§èƒ½åˆ†æ

### æ€§èƒ½æŒ‡æ ‡

ç³»ç»Ÿè®¡ç®—ä»¥ä¸‹RMSEï¼ˆå‡æ–¹æ ¹è¯¯å·®ï¼‰æŒ‡æ ‡ï¼š
- uæ–¹å‘ï¼ˆçºµè¡é€Ÿåº¦ï¼‰
- væ–¹å‘ï¼ˆæ¨ªè¡é€Ÿåº¦ï¼‰ 
- ræ–¹å‘ï¼ˆè‰æ‘‡è§’é€Ÿåº¦ï¼‰

## ğŸ”§ API ä½¿ç”¨è¯´æ˜


### NMPCè½¨è¿¹è·Ÿè¸ªæ§åˆ¶ä¼ å‚éªŒè¯

ç³»ç»Ÿæ”¯æŒé€šè¿‡å‘½ä»¤è¡Œå‚æ•°è¿›è¡ŒNMPCè½¨è¿¹è·Ÿè¸ªæ§åˆ¶éªŒè¯ï¼Œæä¾›çµæ´»çš„æµ‹è¯•é€‰é¡¹ã€‚

#### å‘½ä»¤è¡Œå‚æ•°è¯´æ˜

| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
| :--- | :--- | :--- | :--- |
| `--model` | int | 1 | æ¨¡å‹ç±»åˆ«ï¼š1=åŸºç¡€æ¨¡å‹, 2=åˆ†ç¦»æ¨¡å‹, 3=ç®€åŒ–æ¨¡å‹ |
| `--trajectory` | int | 1 | è·Ÿè¸ªæ›²çº¿ï¼š1=æ¤­åœ†, 2=æ­£å¼¦ç›´çº¿, 3=åŒæ­£å¼¦ |
| `--adaptive` | flag | False | å¯ç”¨è‡ªé€‚åº”NMPCæ§åˆ¶ |
| `--output_dir`| str | nmpc_results | è¾“å‡ºæ–‡ä»¶ç›®å½• |

#### æ”¯æŒçš„æ¨¡å‹ä¸è½¨è¿¹

- **æ¨¡å‹ç±»åˆ«**:
    - **Model 1**: åŸºç¡€æ¨¡å‹ (18å‚æ•°)
    - **Model 2**: åˆ†ç¦»æ¨¡å‹ (21å‚æ•°)
    - **Model 3**: ç®€åŒ–æ¨¡å‹ (16å‚æ•°)
- **è·Ÿè¸ªæ›²çº¿**:
    - **è½¨è¿¹1**: æ¤­åœ†è½¨è¿¹ `x = 40*sin(t) + 1, y = 30*cos(t) + 1`
    - **è½¨è¿¹2**: æ­£å¼¦ç›´çº¿è½¨è¿¹ `x = 40*sin(t) + 1, y = t`
    - **è½¨è¿¹3**: åŒæ­£å¼¦è½¨è¿¹ `x = 40*sin(t) + 1, y = 30*sin(0.5*t) + 1`

#### ä½¿ç”¨ç¤ºä¾‹

```bash
# Model 1 + æ¤­åœ†è½¨è¿¹ + è‡ªé€‚åº”æ§åˆ¶
python nmpc_tracking/identified_model_nmpc_test.py --model 1 --trajectory 1 --adaptive

# Model 2 + æ­£å¼¦è½¨è¿¹ + éè‡ªé€‚åº”
python nmpc_tracking/identified_model_nmpc_test.py --model 2 --trajectory 2

# Model 3 + åŒæ­£å¼¦è½¨è¿¹ + è‡ªé€‚åº”æ§åˆ¶
python nmpc_tracking/identified_model_nmpc_test.py --model 3 --trajectory 3 --adaptive
```

#### è¾“å‡ºç»“æœä¸åˆ†æ

è¿è¡Œè„šæœ¬åï¼Œç»“æœå°†ä¿å­˜åœ¨ç”± `--output_dir` å‚æ•°æŒ‡å®šçš„ç›®å½•ä¸­ï¼ˆé»˜è®¤ä¸º `nmpc_results`ï¼‰ã€‚

- **CSVæ–‡ä»¶**: `nmpc_identified_model_{model}_for_trajectory_{traj}_results.csv` - è¯¦ç»†ä»¿çœŸæ•°æ®ã€‚
- **æ€§èƒ½æŠ¥å‘Š**: `nmpc_performance_model_{model}_for_trajectory_{traj}_report.txt` - åŒ…å«é…ç½®ä¿¡æ¯å’Œæ€§èƒ½æŒ‡æ ‡ã€‚
- **ç»“æœå›¾ç‰‡**: ç”Ÿæˆè½¨è¿¹å¯¹æ¯”ã€è¯¯å·®ã€çŠ¶æ€å˜é‡å’Œæ¨è¿›å™¨è¾“å‡ºçš„ä¸€ç³»åˆ—å›¾ç‰‡ã€‚

**è½¨è¿¹è·Ÿè¸ªæ•ˆæœå±•ç¤º**

ä¸‹è¡¨å±•ç¤ºäº† `nmpc_results` ç›®å½•ä¸­ä¸‰ç§å…¸å‹å®éªŒçš„ç»“æœã€‚

| æ¨¡å‹ | è½¨è¿¹ | è½¨è¿¹è·Ÿè¸ªå¯¹æ¯” | è·Ÿè¸ªè¯¯å·® |
|  :---: | :---: | :---: | :---: |
| æ¨¡å‹1 | è½¨è¿¹1 (æ¤­åœ†) |![è½¨è¿¹1](nmpc_results/nmpc_trajectory_1_for_trajectory_1.png) | ![è¯¯å·®1](nmpc_results/nmpc_error_1_for_trajectory_1.png) |
| æ¨¡å‹2 | è½¨è¿¹2 (æ­£å¼¦) |![è½¨è¿¹2](nmpc_results/nmpc_trajectory_2_for_trajectory_2.png) | ![è¯¯å·®2](nmpc_results/nmpc_error_2_for_trajectory_2.png) |
| æ¨¡å‹3 | è½¨è¿¹3 (åŒæ­£å¼¦) |![è½¨è¿¹3](nmpc_results/nmpc_trajectory_3_for_trajectory_3.png) | ![è¯¯å·®3](nmpc_results/nmpc_error_3_for_trajectory_3.png) |


**å®éªŒç»“æœç®€è¦åˆ†æ**

| æ¨¡å‹ | è½¨è¿¹ | å¹³å‡ä½ç½®è¯¯å·® (m) | å¹³å‡èˆªå‘è¯¯å·® (rad) | ç®€è¦åˆ†æ |
| :--- | :--- | :--- | :--- | :--- |
| **æ¨¡å‹1** | è½¨è¿¹1 (æ¤­åœ†) | ~0.25 | ~0.05 | è·Ÿè¸ªæ•ˆæœè‰¯å¥½ï¼Œè¯¯å·®è¾ƒå°ï¼Œè¡¨ç°ç¨³å®šï¼Œé€‚ç”¨äºå¸¸è§„ä»»åŠ¡ã€‚ |
| **æ¨¡å‹2** | è½¨è¿¹2 (æ­£å¼¦) | ~0.22 | ~0.04 | å‡­å€Ÿæ›´ç²¾ç»†çš„æ¨¡å‹ç»“æ„ï¼Œç²¾åº¦æœ€é«˜ï¼Œèƒ½å¤Ÿå¿«é€Ÿå“åº”è½¨è¿¹å˜åŒ–ã€‚ |
| **æ¨¡å‹3** | è½¨è¿¹3 (åŒæ­£å¼¦) | ~0.30 | ~0.07 | ç®€åŒ–æ¨¡å‹è®¡ç®—é€Ÿåº¦å¿«ï¼Œä½†åœ¨å¤æ‚è½¨è¿¹ä¸‹ç²¾åº¦ç•¥æœ‰ç‰ºç‰²ã€‚ |

*æ³¨ï¼šä»¥ä¸Šæ€§èƒ½æŒ‡æ ‡ä¸ºç¤ºä¾‹ï¼Œå…·ä½“æ•°å€¼è¯·å‚è€ƒ `nmpc_results` ç›®å½•ä¸‹ç”Ÿæˆçš„æ€§èƒ½æŠ¥å‘Šã€‚*

è¯¦ç»†ä½¿ç”¨è¯´æ˜è¯·å‚è€ƒï¼š[NMPCå‚æ•°ä¼ é€’ä½¿ç”¨è¯´æ˜](NMPC_å‚æ•°ä¼ é€’ä½¿ç”¨è¯´æ˜.md)

## ğŸ¯ æ¨¡å‹é€‰æ‹©æŒ‡å—

| æ¨¡å‹ | å¤æ‚åº¦ | ç²¾åº¦ | è®¡ç®—é€Ÿåº¦ | é€‚ç”¨åœºæ™¯ |
|------|--------|------|----------|----------|
| æ¨¡å‹1 | ä½ | ä¸­ç­‰ | å¿« | å¿«é€ŸåŸå‹ã€å®æ—¶æ§åˆ¶ |
| æ¨¡å‹2 | ä¸­ç­‰ | é«˜ | ä¸­ç­‰ | å¹³è¡¡ç²¾åº¦ä¸æ•ˆç‡ |
| æ¨¡å‹3 | é«˜ | æœ€é«˜ | æ…¢ | é«˜ç²¾åº¦ä»¿çœŸã€ç¦»çº¿åˆ†æ |

## ğŸ” æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **CasADiå¯¼å…¥é”™è¯¯**
   ```bash
   pip install casadi
   ```

2. **æ•°å€¼æº¢å‡ºè­¦å‘Š**
   - æ£€æŸ¥æ¨¡å‹å‚æ•°æ˜¯å¦åˆç†
   - è°ƒæ•´NMPCæ§åˆ¶å™¨å‚æ•°
   - å‡å°ä»¿çœŸæ­¥é•¿

3. **å‚æ•°è¾¨è¯†å¤±è´¥**
   - æ£€æŸ¥æ•°æ®æ–‡ä»¶è·¯å¾„
   - ç¡®è®¤æ•°æ®æ ¼å¼æ­£ç¡®
   - è°ƒæ•´ä¼˜åŒ–å™¨å‚æ•°

4. **ç»˜å›¾æ˜¾ç¤ºé—®é¢˜**
   - ç¡®ä¿å®‰è£…äº†matplotlib
   - æ£€æŸ¥å­—ä½“è®¾ç½®
   - éªŒè¯æ•°æ®å®Œæ•´æ€§

### æ€§èƒ½ä¼˜åŒ–å»ºè®®

- å¯¹äºå®æ—¶åº”ç”¨ï¼Œæ¨èä½¿ç”¨æ¨¡å‹1
- è°ƒæ•´NMPCé¢„æµ‹æ—¶åŸŸä»¥å¹³è¡¡æ€§èƒ½å’Œè®¡ç®—é€Ÿåº¦
- ä½¿ç”¨å¹¶è¡Œè®¡ç®—åŠ é€Ÿå‚æ•°è¾¨è¯†è¿‡ç¨‹
- é€‰æ‹©åˆé€‚çš„æ»¤æ³¢æ–¹æ³•ä»¥æé«˜æ•°æ®è´¨é‡

## ğŸ“š é…ç½®æ–‡ä»¶è¯´æ˜

æ¯ä¸ªæ¨¡å‹éƒ½æœ‰å¯¹åº”çš„é…ç½®æ–‡ä»¶ï¼Œä½äº `config/` ç›®å½•ï¼š

- `model1_config.json`ï¼šæ¨¡å‹1çš„å‚æ•°é…ç½®
- `model2_config.json`ï¼šæ¨¡å‹2çš„å‚æ•°é…ç½®  
- `model3_config.json`ï¼šæ¨¡å‹3çš„å‚æ•°é…ç½®

é…ç½®æ–‡ä»¶åŒ…å«ï¼š
- æ¨¡å‹å‚æ•°åˆå€¼
- NMPCæ§åˆ¶å™¨å‚æ•°
- ä»¿çœŸè®¾ç½®
- æ•°æ®å¤„ç†å‚æ•°

## ğŸ“Š æ•°æ®æ ¼å¼è¯´æ˜

ç³»ç»Ÿä½¿ç”¨ç»Ÿä¸€çš„æ•°æ®æ ¼å¼ï¼ŒåŒ…å«ä»¥ä¸‹æ ‡å‡†åˆ—ï¼š

- **æ—¶é—´åˆ—**ï¼š`time` - ä»¿çœŸæ—¶é—´
- **çŠ¶æ€å˜é‡**ï¼š`u`, `v`, `r`, `x`, `y`, `psi` - èˆ¹èˆ¶çŠ¶æ€
- **æ§åˆ¶è¾“å…¥**ï¼š`Ts`, `Tp` - æ¨è¿›å™¨æ§åˆ¶é‡
- **å‚è€ƒä¿¡å·**ï¼š`u_ref`, `v_ref`, `r_ref`, `x_ref`, `y_ref`, `psi_ref`
- **è·Ÿè¸ªè¯¯å·®**ï¼š`error_x`, `error_y`, `error_psi`

## ğŸ¤ è´¡çŒ®æŒ‡å—

æ¬¢è¿è´¡çŒ®ä»£ç ï¼è¯·éµå¾ªä»¥ä¸‹æ­¥éª¤ï¼š

1. Fork æœ¬é¡¹ç›®
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. å¼€å¯ Pull Request

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - æŸ¥çœ‹ [LICENSE](LICENSE) æ–‡ä»¶äº†è§£è¯¦æƒ…ã€‚

## ğŸ“ è”ç³»æ–¹å¼

- **GitHub**: [https://github.com/2345vor/MI](https://github.com/2345vor/MI)
- **é‚®ç®±**: 3126171871@qq.com

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œæ¬¢è¿é€šè¿‡GitHub Issuesæˆ–é‚®ä»¶è”ç³»ã€‚

---

**æ³¨æ„**: æœ¬ç³»ç»Ÿä»…ç”¨äºç ”ç©¶å’Œæ•™è‚²ç›®çš„ï¼Œå®é™…åº”ç”¨æ—¶è¯·æ ¹æ®å…·ä½“éœ€æ±‚è¿›è¡Œé€‚å½“ä¿®æ”¹å’ŒéªŒè¯ã€‚

## ğŸ”® æœªæ¥å·¥ä½œ

- **å®ç‰©éªŒè¯**: å°†å½“å‰ä»¿çœŸæˆæœæ‹¿å‡ºæ¥åº”ç”¨äºå®ç‰©å¹³å°ï¼Œè¿›è¡Œè·‘ç‚¹ã€è·¯å¾„è·Ÿè¸ªæˆ–ä»»åŠ¡è½¨è¿¹çš„å®éªŒéªŒè¯ã€‚
- **ç®—æ³•å¢å¼º**: å®ç°æ›´å¤šå…ˆè¿›çš„è¾¨è¯†ç®—æ³•ï¼ˆå¦‚é—ä¼ ç®—æ³•ã€ç²’å­ç¾¤ä¼˜åŒ–ï¼‰å’Œæ§åˆ¶ç®—æ³•ã€‚
- **åœ¨çº¿è¾¨è¯†ä¸è‡ªé€‚åº”æ§åˆ¶**: å¼€å‘åœ¨çº¿å‚æ•°è¾¨è¯†åŠŸèƒ½ï¼Œç»“åˆè‡ªé€‚åº”æ§åˆ¶ç­–ç•¥ï¼Œæé«˜ç³»ç»Ÿå¯¹ç¯å¢ƒå˜åŒ–çš„é²æ£’æ€§ã€‚
- **å›¾å½¢ç”¨æˆ·ç•Œé¢ (GUI)**: å¼€å‘ä¸€ä¸ªç”¨æˆ·å‹å¥½çš„å›¾å½¢ç•Œé¢ï¼Œç®€åŒ–æ“ä½œæµç¨‹ï¼Œæé«˜æ˜“ç”¨æ€§ã€‚
- **ä»£ç ä¼˜åŒ–**: è¿›ä¸€æ­¥ä¼˜åŒ–ä»£ç ï¼Œæé«˜è®¡ç®—æ•ˆç‡ï¼Œç‰¹åˆ«æ˜¯åœ¨åµŒå…¥å¼ç³»ç»Ÿä¸Šçš„å®æ—¶æ€§èƒ½ã€‚

## ğŸ“– ç›¸å…³æ–‡æ¡£

- [ä½¿ç”¨ç¤ºä¾‹](examples/usage_examples.md) - è¯¦ç»†çš„ä½¿ç”¨ç¤ºä¾‹å’Œæœ€ä½³å®è·µ
- [NMPCå‚æ•°ä¼ é€’ä½¿ç”¨è¯´æ˜](NMPC_å‚æ•°ä¼ é€’ä½¿ç”¨è¯´æ˜.md) - NMPCè½¨è¿¹è·Ÿè¸ªæ§åˆ¶ä¼ å‚éªŒè¯è¯¦ç»†è¯´æ˜
- [English README](README.md) - English version of this document